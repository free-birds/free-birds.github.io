<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <title> Front-End Engineering：Module with Truckjs - Shmily </title>
    <meta name="generator" content="Jekyll" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <meta name="format-detection" content="address=no" />

    <link rel="icon" type="image/png" sizes="96x96" href="/static/imgs/favicon/favicon-32x32.png" />
    <link rel="stylesheet" href="/static/css/layout.css" />
</head>
<body>
    <!--[if lt IE 8]>
<div>
    <p>
        已经有超过90%的用户使用更高版本
        <a target="_blank" title="下载Chrome" href="http://www.google.com/chrome/">Google Chrome</a>
        或
        <a target="_blank" href="http://www.microsoft.com/zh-cn/download/ie.aspx?q=internet+explorer">Internet Explorer</a>
        体验到了更流畅更精彩的页面，你还不试试？
    </p>
</div>
<![endif]-->

<header class="header">
    <nav class="navbar">
        <div class="slogan">
            <a href="/">Shmily</a>
        </div>
        <div class="menu">
            <spam class="menu-icon" id="js-menu-toggle"></spam>
            <ul class="menu-list">
                
                <li class="menu-item">
                <a href="/home/">
                <i class="fa "></i>
                Home</a>
                </li>
                
                <li class="menu-item">
                <a href="/posts/">
                <i class="fa "></i>
                Posts</a>
                </li>
                
                <li class="menu-item">
                <a href="/about/">
                <i class="fa "></i>
                About Me</a>
                </li>
                
            </ul>
        </div>
    </nav>
</header>

    <section class="content">
        <article>
            <div class="markdown-body">
  <h1>Front-End Engineering：Module with Truckjs</h1>
  <p class="meta">10 Nov 2015 - Meituan, Beijing</p>
  <p>Front-End Engineering(FEE) is an engineering design approach used to control project expenses and improve work flow efficiency, focuses on technical requirements.
For better realizing TruckJS, the tool of Meituan resolving FEE, I tried to use TruckJS here for optimization.</p>

<!--more-->

<p>Here’s a series of posts to describe the optimization:</p>

<ol>
  <li>Module with TruckJS</li>
  <li><a href="/posts/localstorage/">Cache Management</a></li>
  <li><a href="/posts/combo/">Combo Server</a></li>
</ol>

<h2 id="module-loader">Module loader</h2>

<p>In its narrower sense, TruckJS is a JavaScript file and module loader, like <a href="http://requirejs.org/">RequireJS</a>. Using a modular script loader will improve the speed and quality of your code.</p>

<h4 id="define-before-execute">Define before Execute</h4>

<ol>
  <li>set <code class="highlighter-rouge">requires.config</code> and <code class="highlighter-rouge">require()</code> in head</li>
  <li>use <code class="highlighter-rouge">require(module, callback)</code> in foot, <code class="highlighter-rouge">requirejs.__require.push(args)</code></li>
  <li>execute <code class="highlighter-rouge">callback</code> when truckjs loaded</li>
</ol>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">requirejs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">__require</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">__requirejsConfig</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">baseUrl</span><span class="p">:</span> <span class="s1">'http://localhost:4000'</span><span class="p">,</span>
            <span class="na">prefix</span><span class="p">:</span> <span class="s1">'/static/js/'</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="nx">require</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">requirejs</span><span class="p">.</span><span class="nx">__require</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
    <span class="p">};</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<blockquote>
  <p>Compare to RequireJS： <br /></p>
  <ol>
    <li><code class="highlighter-rouge">requirejs.config</code> must set in head，after requirejs loader, truckjs could set it before <br /></li>
    <li>all deps will be resovled when truckjs loaded <br /></li>
  </ol>
</blockquote>

<h4 id="algorithm-of-resolving-deps">Algorithm of Resolving Deps</h4>

<p>Build the deps topology(Directed Acyclic Graph) from <code class="highlighter-rouge">__denpendencies[]</code> and get topological order, then <code class="highlighter-rouge">depending()</code>.</p>

<p>Start from root(the page as root):</p>

<ol>
  <li><code class="highlighter-rouge">depending()</code>: make sure that this module isn’t <code class="highlighter-rouge">executed()</code>，and has <code class="highlighter-rouge">__denpendencies[]</code>，otherwise <code class="highlighter-rouge">ready()</code>, <code class="highlighter-rouge">executing()</code>, <code class="highlighter-rouge">executed()</code> directly</li>
  <li><code class="highlighter-rouge">loadModules()</code>: load modules of <code class="highlighter-rouge">__denpendencies[0]</code> first always</li>
  <li><code class="highlighter-rouge">loading()</code>: if this module has been stored in localStorage</li>
  <li>If stored, <code class="highlighter-rouge">loaded()</code> and get its <code class="highlighter-rouge">__denpendencies[]</code>, continue to <code class="highlighter-rouge">depending()</code></li>
  <li>Otherwise, merged and sent request to get code to <code class="highlighter-rouge">eval()</code>, continue to step 4</li>
</ol>

<p>Repeat step 1 to 5, util every <code class="highlighter-rouge">__denpendencies[]</code> all <code class="highlighter-rouge">executed()</code>.</p>

<blockquote>
  <p>Compare to RequireJS： <br /></p>
  <ol>
    <li>node’s deps requests will merged into one, and decombo when file loaded <br /></li>
    <li>but server need to provide combo to response <br /></li>
  </ol>
</blockquote>

<h4 id="network-loading">Network loading</h4>

<p>Here’s loading graph of modules,
<img src="/static/img/post/truck.png" alt="img" /></p>

<p>Next, we need combo to merge requests, details in
<a href="/posts/combo/">Front-End Engineering：Combo Server</a></p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
    <li class="text-ellipsis">
      <span>09 Dec 2015</span> &raquo; <a href="/posts/router//">Router Middleware For Koa</a>
    </li>
    
    <li class="text-ellipsis">
      <span>25 Nov 2015</span> &raquo; <a href="/posts/localstorage//">Front-End Engineering：Cache Management</a>
    </li>
    
    <li class="text-ellipsis">
      <span>23 Nov 2015</span> &raquo; <a href="/posts/yahoo//">Best Practices For Speeding Up Your Web Site</a>
    </li>
    
  </ul>
</div>
        </article>
    </section>
    <footer class="footer">
    <div class="copyright">
        <div class="contact">
            <p>Copyright @YML</p>
            <p>Geek of <a href="http://github.com/">GitHub</a></p>
            <p>aworksmart@gmail.com</p>
        </div>
        <div class="contact">
            <p><a href="http://weibo.com/ihaosir/">weibo.com/ihaosir</a></p>
            <p><a href="http://github.com/free-birds/">github.com/free-birds</a></p>
            <p><a href="http://childlike.me/">childlike.me</a></p>
        </div>
    </div>
</footer>

</body>
<script src="/static/js/libs/zepto.js"></script>
    <script src="/static/js/plugin.js"></script>
    <script src="/static/js/site.js"></script>
</html>
